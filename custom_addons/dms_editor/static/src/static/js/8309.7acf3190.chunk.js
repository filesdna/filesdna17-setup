"use strict";(self.webpackChunkfilesdna=self.webpackChunkfilesdna||[]).push([[8309],{78309:(e,i,s)=>{s.r(i),s.d(i,{default:()=>C});var n=s(9950),a=s(41135),t=s(37734),l=s(68265),r=s(72612),d=s(35398),o=s(87094),m=s(41988),c=s(1203),u=s(55902),g=s(23072),x=s(68902),p=s(41397),h=s(41893),j=s(6819),A=s(10597),v=s(96272),f=s(8187),y=s(35676),b=s(19726),S=s(25884),U=s(21367),I=s(19929),_=s(13239),k=s(98341),L=s(93347),R=s(9941),w=s(44414);function D(e,i){const{visible:s,type:a,handleSubmit:D=(()=>{}),user:O={},showSaved:C=!1,setDisable:F=(()=>{}),submitLoading:N=!1,setSubmitLoader:E=(()=>{}),user_id:T}=e,B="initial"===a,V="sign"===a,{userData:P}=(0,k.useSelector)((e=>e.Auth)),z=(0,p.isObject)(O)&&!(0,p.isEmpty)(O)?O:P||{},H=(0,f.dS)(z.first_name,z.last_name)||"";let K=H.match(/\b\w/g)||[];K=((K.shift()||"")+(K.pop()||"")).toUpperCase();const M={full_name:H,initial_name:K},[Y,q]=n.useState({trimmedSignURL:null,trimmedInitURL:null,signs:[]}),[G]=l.A.useForm(),[J,Q]=(0,n.useState)({}),[W,X]=(0,n.useState)("choose"),[Z,$]=(0,n.useState)({signImageUrl:"",initialsImageUrl:""}),{signImageUrl:ee,initialsImageUrl:ie}=Z;(0,n.useEffect)((()=>{s&&X(C&&z.email&&"public"!==z.email?"saved":"choose")}),[s]),(0,n.useEffect)((()=>{s&&"saved"===W&&z.email&&"public"!==z.email&&(!Y.signs||(0,p.isEmpty)(Y.signs))&&async function(){q((e=>({...e,loading:!0})));try{const e=await(0,j.Ay)("user/get-signature");if("Unauthorized"===e.message)return void(0,h.A)("error","common.sessionExpired");e.success&&(0,p.isArray)(e.data)?q((i=>({...i,loading:!1,signs:e.data}))):q((e=>({...e,loading:!1})))}catch(e){q((e=>({...e,loading:!1})))}}()}),[W]),(0,y.A)({form:G,visible:s,initVal:M});const se=e=>{const i={...e};i.type=W,"upload"===W?(i.signature=null===Z||void 0===Z?void 0:Z.signImageUrl,i.initial=null===Z||void 0===Z?void 0:Z.initialsImageUrl):"draw"===W?(i.signature=null===Y||void 0===Y?void 0:Y.trimmedSignURL,i.initial=null===Y||void 0===Y?void 0:Y.trimmedInitURL):"saved"===W?i.sign_id=null===J||void 0===J?void 0:J.id:i.signature_font=(null===J||void 0===J?void 0:J.signature_font)||"roboto",i.date=Y.signDate,i.sign_by=Y.signBy,i.reason=Y.signReason,i.no_design=Y.noDesign,async function(e){E(!0);try{const i=new FormData;i.append("pType","sign"===a?"full":a),i.append("user_id",T),Object.entries(e).forEach((e=>{let[s,n]=e;void 0!==n&&i.append(s,n)}));const s=await(0,j.Ay)("add-sign",i,"POST",void 0,!0);s.success&&s.data?(E(!1),D(s.data)):(E(!1),(0,h.A)("error",s.message))}catch(i){E(!1),(0,h.A)("error")}}(i)};function ne(e,i){const s=i("full_name"),n=i("initial_name"),t=V&&!s||B&&!n;return"saved"===e?(0,w.jsx)(r.A,{spinning:Y.loading||!1,children:(0,w.jsx)("div",{className:"signatureList",children:(0,w.jsx)(b.A,{state:Y,dataSource:Y.signs||[],renderItem:i=>{const s=i.id===J.id;return(0,w.jsx)(d.A.Item,{onClick:()=>{Q({...i,type:e})},children:(0,w.jsx)(d.A.Item.Meta,{title:(0,w.jsxs)(o.A,{style:{alignItems:"center"},children:[(0,w.jsx)(m.A,{xs:4,sm:3,children:(0,w.jsx)(I.jl,{children:s&&(0,w.jsx)(_.A,{})})}),(0,w.jsx)(m.A,{xs:20,sm:17,children:(0,w.jsx)("div",{className:"sign-main",children:(0,w.jsx)("img",{alt:B?i.initial_name:i.full_name,src:B?i.initial_signature:i.full_signature})})})]})})})}})})}):"choose"===e?t?(0,w.jsx)(c.A,{}):(0,w.jsx)(b.A,{state:Y,selectedSign:J,setSelectedSign:i=>{Q({...i,type:e})},pType:a,name:s,initials:n}):"draw"===e?(0,w.jsxs)(w.Fragment,{children:[ae(Y.trimmedSignURL,s),(0,w.jsx)(S.A,{setState:e=>{q(e)},trimmedInitURL:Y.trimmedInitURL,trimmedSignURL:Y.trimmedSignURL,pType:a})]}):"upload"===e?(0,w.jsxs)(w.Fragment,{children:[ae(ee,s),(0,w.jsx)(U.A,{beforeUpload:(e,i)=>{((e,i)=>{const s=(0,f.cd)(e,"custom");s.status?(0,f.In)(e,(e=>{$("sign"===i?i=>({...i,signImageUrl:e,loading:!1}):i=>({...i,initialsImageUrl:e,loading:!1}))})):(0,h.A)("error",s.message)})(e,i)},signImageUrl:ee,initialsImageUrl:ie,setUploadData:e=>{$(e)},pType:a})]}):null}function ae(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;return(0,w.jsx)(v.pO,{children:(0,w.jsx)("div",{className:"signForm mb20",children:(0,w.jsxs)(A.YV,{noDesign:Y.noDesign,children:[(0,w.jsx)("span",{className:"title-top",children:Y.signBy&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(t.A,{id:"signature.signedBy"}),":"," ",(0,w.jsx)("span",{children:i||""})," "]})}),(0,w.jsx)("div",{className:"sign-container",children:e&&(0,w.jsx)("img",{src:e,alt:"sign"})}),(0,w.jsxs)("div",{className:"extraInfo",children:[Y.signDate&&(0,w.jsxs)("span",{children:[Y.signDate," (UTC)"]}),Y.signReason&&(0,w.jsx)("span",{children:Y.signReason})]})]})})})}return(0,n.useEffect)((()=>{const e=(()=>{let e=!1;return"choose"===W||"saved"===W?e=(0,p.isEmpty)(J)||J.type!==W:"draw"===W?e=B&&!Y.trimmedInitURL||V&&!Y.trimmedSignURL:"upload"===W&&(e=V&&!Z.signImageUrl||B&&!Z.initialsImageUrl),e})();F(e)}),[W,Y,Z,J,s]),(0,n.useImperativeHandle)(i,(()=>({onOk(){G.validateFields().then((e=>{se(e)})).catch((e=>{console.log("Validate Failed:",e)}))}}))),(0,w.jsx)("div",{className:"w100",children:(0,w.jsx)(r.A,{spinning:N||!1,children:(0,w.jsx)(A._H,{children:(0,w.jsxs)(l.A,{form:G,layout:"horizontal",children:[(0,w.jsxs)(o.A,{gutter:[20],children:[V&&(0,w.jsx)(m.A,{xs:24,sm:12,children:(0,w.jsx)(l.A.Item,{name:"full_name",label:(0,w.jsx)(t.A,{id:"signature.name"}),rules:[{max:50,message:(0,w.jsx)(t.A,{id:"err.max.50char"})},{whitespace:!0,message:(0,w.jsx)(t.A,{id:"err.blankSpace"})}],children:(0,w.jsx)(u.A,{})})}),B&&(0,w.jsx)(m.A,{xs:24,sm:12,children:(0,w.jsx)(l.A.Item,{name:"initial_name",label:(0,w.jsx)(t.A,{id:"signature.initials"}),rules:[{max:20,message:(0,w.jsx)(t.A,{id:"err.max.20char"})},{whitespace:!0,message:(0,w.jsx)(t.A,{id:"err.blankSpace"})}],children:(0,w.jsx)(u.A,{})})})]}),(0,w.jsx)(g.A,{style:{margin:"15px 0px"}}),(0,w.jsx)(R.A,{setState:q,state:Y}),(0,w.jsx)(g.A,{style:{margin:"10px 0px"}}),(0,w.jsx)(x.A,{defaultActiveKey:W,activeKey:W,onChange:e=>{X(e)},children:L.gV.map((e=>"saved"===e.type&&(!C||"public"===z.email)?null:(0,w.jsx)(x.A.TabPane,{tab:(0,w.jsx)(t.A,{id:e.title}),children:(0,w.jsx)(l.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.full_name!==i.full_name||e.initial_name!==i.initial_name,children:i=>{let{getFieldValue:s}=i;return ne(e.type,s)}})},e.type)))})]})})})})}const O=(0,n.forwardRef)(D);const C=function(e){const{visible:i,type:s,handleSubmit:l=(()=>{}),user:r={},showSaved:d=!0,className:o,user_id:m}=e,c=(0,n.useRef)(null),u="initial"===s,[g,x]=n.useState({trimmedSignURL:null,trimmedInitURL:null,signs:[],isOkDisabled:!1}),[p,h]=(0,n.useState)(!1),j=()=>!p&&(e.onClose(),!0);return(0,w.jsx)(a.A,{className:o,style:{top:50},open:i,onClose:j,title:(0,w.jsx)(t.A,{id:u?"common.addInitial":"common.addSign"}),onOk:()=>{null!==c&&void 0!==c&&c.current&&c.current.onOk()},onCancel:j,destroyOnClose:!0,closable:!0,width:600,okText:(0,w.jsx)(t.A,{id:"common.add"}),cancelButtonProps:{key:"back"},okButtonProps:{id:"sign-ok",key:"submit",loading:p,disabled:g.isOkDisabled},children:(0,w.jsx)(O,{ref:c,visible:i,type:s,handleSubmit:e=>l(e),setDisable:e=>x((i=>({...i,isOkDisabled:e}))),user:r,showSaved:d,submitLoading:p,setSubmitLoader:h,user_id:m})})}}}]);