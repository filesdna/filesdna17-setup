"use strict";(self.webpackChunkfilesdna=self.webpackChunkfilesdna||[]).push([[7502],{97502:(e,s,t)=>{t.r(s),t.d(s,{default:()=>V});var i=t(79378),n=t(15306),a=t(44070),r=t(58769),d=t(41893),o=t(79796),c=t(19392),l=t(21270),m=t(37734),u=t(13771),h=t(6819),x=t(8187),p=t(99386),j=t(35398),A=t(29796),g=t(22748),f=t(55327),v=t(10495),_=t(41988),y=t(87094),w=t(72612),b=t(41397),S=t(9950),C=t(98341),L=t(78254),D=t(30135),O=t(4159),k=t.n(O),M=t(34845),H=t(12323),T=t(44414);const{Option:E}=p.A,N={assign:{apiUrl:"contact/get-contact",title:"document.assignSigner",cTitle:"document.chooseSigner",cDesc:"document.chooseSignerDesc",hideAccess:!0,signleSelection:!0}};const V=(0,D.j4)((function(e){var s;const t=window.innerHeight||800,{type:D="",handleSubmit:O=(()=>{}),visible:V=!1,onClose:Y=(()=>{}),rowData:F={},fetchData:I=(()=>{}),intl:P,secureShare:q,disableDownload:U}=e,B=N[D]||{},R=(0,S.useRef)(null),z=(0,C.useSelector)((e=>e.Auth.access)),W=0===(null===z||void 0===z||null===(s=z.monthly_features)||void 0===s?void 0:s.num_of_share_doc)&&"share"===D,K=(0,b.isObject)(z)?z:{},G=K.view_team&&K.view_department,[J,Q]=(0,S.useState)(!1),[X,Z]=(0,S.useState)([]),[$,ee]=(0,S.useState)({addContactVis:!1}),[se,te]=(0,S.useState)({teamMembers:[],depts:[],loading:!1});function ie(e,s){const t=(null===s||void 0===s?void 0:s.obj)||{},i=(null===s||void 0===s?void 0:s.key)||"";if(!(0,b.isEmpty)(t)){const s=t.email?t.email.toLowerCase():"",i=t.name?t.name.toLowerCase():"",n=t.first_name?t.first_name.toLowerCase():"",a=t.last_name?t.last_name.toLowerCase():"";return s.indexOf(e.toLowerCase())>=0||i.indexOf(e.toLowerCase())>=0||n.indexOf(e.toLowerCase())>=0||a.indexOf(e.toLowerCase())>=0}return"new"===i}function ne(e,s){const t=[...X];t.splice(e,1),Z(t),(0,d.A)("success","documents.shareRemoveSuccess"),"update-doc-list"===s&&(0,b.isEmpty)(t)&&I("disable-reload")}function ae(e,s){e.share_id?async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;te((e=>({...e,sharedLoading:!0})));try{const t=await(0,h.Ay)("file/delete-share-document",{share_id:e},"POST");t.success?(te((e=>({...e,sharedLoading:!1}))),ne(s,"update-doc-list")):(te((e=>({...e,sharedLoading:!1}))),(0,d.A)("error",t.message))}catch(t){te((e=>({...e,sharedLoading:!1}))),(0,d.A)("error")}}(e.share_id,s):ne(s)}function re(e){const s=(0,b.isObject)(e)&&e.name?e.name:"",t=(0,b.isObject)(e)&&e.email?e.email:"",a=(0,b.isString)(e)?e:t,r=(0,b.isObject)(e)&&!!e.department_id,d=(0,b.isObject)(e)&&!!e.user_id?e.name||(0,T.jsx)(m.A,{id:"team.member"}):(0,T.jsx)(m.A,{id:"common.new"});if("assign"===D){const s=(0,x.dS)(e.first_name,e.last_name);return(0,T.jsx)(j.A.Item.Meta,{avatar:(0,T.jsx)(A.A,{icon:(0,T.jsx)(i.A,{})}),title:s,description:e.email})}return(0,T.jsx)(j.A.Item.Meta,{avatar:(0,T.jsx)(A.A,{icon:r?(0,T.jsx)(n.A,{}):(0,T.jsx)(i.A,{})}),title:a||s,description:r?(0,T.jsx)(m.A,{id:"dept.dept"}):d})}function de(e,s){return(0,T.jsx)(g.A,{title:(0,T.jsx)(m.A,{id:"document.expiryDate"}),children:(0,T.jsx)(f.A,{placeholder:P.formatMessage({id:"document.expiryDate"}),disabledDate:x.LK,onChange:e=>{const t=[...X],i=e?e.format("YYYY-MM-DD"):"";t[s].share_id&&t[s].expire_date!==i&&(t[s].is_update=!0),t[s].expire_date=i,Z(t)},format:"DD-MM-YYYY",value:e.expire_date?k()(e.expire_date,"YYYY-MM-DD"):null,size:"small",style:{width:110}})})}function oe(e,s){const t=(0,b.isObject)(e)&&e.email?e.email:"",i=(0,b.isString)(e)?e:t;return(0,T.jsx)(j.A.Item,{extra:(0,T.jsxs)("div",{className:"listAction",children:[de(e,s),(0,T.jsx)(o.A,{children:(0,T.jsx)(c.A,{shape:"circle",icon:(0,T.jsx)(a.A,{}),className:"deleteCircle",onClick:()=>ae(e,s)})})]}),actions:[(0,T.jsx)(g.A,{placement:"bottomLeft",title:(0,T.jsx)(m.A,{id:"document.shareDownloadTip"}),children:(0,T.jsx)(v.A,{checked:e.is_download,onChange:e=>{const{checked:t}=e.target,i=[...X],n=i[s].is_download;i[s].share_id&&Number(t)!==Number(n)&&(i[s].is_update=!0),i[s].is_download=t,Z(i)},disabled:U,children:(0,T.jsx)(m.A,{id:"document.shareDownload"})})}),B.hideAccess?null:(0,T.jsx)(g.A,{placement:"bottomLeft",title:(0,T.jsx)(m.A,{id:"document.docPermissionTip"}),children:(0,T.jsxs)(p.A,{style:{minWidth:100},bordered:!1,value:e.write?"write":"read",onChange:e=>{const t=[...X],i=t[s].write?"write":"read";t[s].share_id&&i!==e&&(t[s].is_update=!0),t[s].write="write"===e,Z(t)},children:[(0,T.jsx)(E,{value:"read",children:(0,T.jsx)(m.A,{id:"documents.readOnly"})}),(0,T.jsx)(E,{value:"write",children:(0,T.jsx)(m.A,{id:"documents.readWrite"})})]})}),(0,T.jsx)(g.A,{placement:"bottomLeft",title:(0,T.jsx)(m.A,{id:"document.docPermissionTip"}),children:(0,T.jsx)(H.A,{type:"security",user:e,index:s,recieipts:[...X],setReceipentsData:e=>{const t=null!==e&&void 0!==e&&e.recieiptsAry?[...e.recieiptsAry]:[...X],i=t[s].security_type;t[s].share_id&&i!==e.sec_type&&(t[s].is_update=!0),t[s].security_type=e.sec_type,Z(t)},disableAction:!1,usedFor:"shareDoc"})})],children:re(e)},i||e.department_id)}function ce(e,s){if("assign"===D)return(0,T.jsxs)(E,{value:e.email,obj:e,children:[(0,T.jsx)("p",{style:{fontWeight:550},children:(0,x.dS)(e.first_name,e.last_name)}),(0,T.jsx)("p",{children:e.email})]},e.email);const t=!!e.department_id;return(0,T.jsxs)(E,{value:e.email||e.department_id,obj:e,children:[(0,T.jsx)("p",{children:t?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("strong",{children:e.name}),(0,T.jsx)("small",{className:"block",children:(0,T.jsx)(m.A,{id:"dept.dept"})})]}):e.name}),(0,T.jsx)("p",{children:(0,T.jsx)("strong",{children:e.email})})]},"".concat(e.email,"_").concat(s))}return(0,S.useEffect)((()=>{var e;const s=null===F||void 0===F||null===(e=F.properties)||void 0===e?void 0:e.signer;V&&"assign"===D&&s&&Z([s])}),[V]),(0,S.useEffect)((()=>{V?(W||async function(){te((e=>({...e,loading:!se.teamMembers||(0,b.isEmpty)(se.teamMembers)})));try{const i=await(0,h.Ay)(B.apiUrl||"department/get-team-department");if(i.success&&i.data){var e,s,t;const n=(null===i||void 0===i||null===(e=i.data)||void 0===e?void 0:e.team)||[],a=(null===i||void 0===i||null===(s=i.data)||void 0===s?void 0:s.department)||[],r=(0,b.isArray)(i.data)&&"assign"===D?i.data:[],d=(null===i||void 0===i||null===(t=i.data)||void 0===t?void 0:t.contact)||r||[];te((e=>({...e,depts:i.data.department||[],teamMembers:[...n,...a,...d],loading:!1})))}else te((e=>({...e,loading:!1}))),(0,d.A)("error",i.message)}catch(i){te((e=>({...e,loading:!1}))),(0,d.A)("error")}}(),"assign"!==D&&async function(){te((e=>({...e,sharedLoading:!0})));try{const e=await(0,h.Ay)("file/get-document-share-users",{document_id:(0,b.isArray)(F)?F[0]:F.id||0},"POST");e.success&&e.data?(Z(e.data),te((e=>({...e,sharedLoading:!1})))):te((e=>({...e,sharedLoading:!1})))}catch(e){te((e=>({...e,sharedLoading:!1}))),(0,d.A)("error")}}()):Z([])}),[V]),(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(r.A,{open:V,onClose:J?null:Y,title:(0,T.jsx)(m.A,{id:B.title||"documents.shareDoc",values:{doc:(0,T.jsx)("strong",{children:F.name})}}),okText:(0,T.jsx)(m.A,{id:"common.ok"}),onOk:J?null:function(){let e=!0;X&&!(0,b.isEmpty)(X)||"assign"===D||(e=!1,Y()),e&&("assign"===D?O(X):async function(e){Q(!0);try{const s=await(0,h.Ay)("file/share-document",e,"POST");s.success?(Q(!1),(0,d.A)("success",s.message),O(s.data||{})):(Q(!1),(0,d.A)("error",s.message))}catch(s){Q(!1),(0,d.A)("error")}}({share_to:X,document_id:F.id||0,secureShare:q,selectedDocs:F}))},onCancel:J?null:Y,confirmLoading:J,okButtonProps:{id:"add-users"},width:550,footer:W&&(0,b.isEmpty)(X)?null:void 0,children:W&&(0,b.isEmpty)(X)&&!se.sharedLoading?(0,T.jsx)(L.default,{msg:"document.shareUpgradeLimit"}):(0,T.jsx)(w.A,{spinning:J||se.loading,children:(0,T.jsx)(M.h2,{children:(0,T.jsx)(y.A,{gutter:6,children:function(){const e=se.teamMembers.filter((e=>X.findIndex((s=>{const t=(0,b.isObject)(s)&&s.email?s.email.toLowerCase():"",i=(0,b.isString)(s)?s.toLowerCase():t,n=(0,b.isObject)(s)&&s.department_id?s.department_id:"";return(0,b.isEqual)(i,e.email)||(0,b.isEqual)(n,e.department_id)}))<0));return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(_.A,{span:24,children:[(0,T.jsxs)("div",{style:{marginBottom:10},children:[(0,T.jsx)("h3",{children:(0,T.jsx)(m.A,{id:B.cTitle||"documents.chooseRecipients"})}),(0,T.jsx)("p",{children:(0,T.jsx)(m.A,{id:G?B.cDesc||"documents.recipientsHint":B.cDesc||"documents.recFreeHint"})})]}),(0,T.jsx)(y.A,{gutter:6,children:(0,T.jsxs)(_.A,{span:24,children:[(0,T.jsxs)(p.A,{disabled:W,showSearch:!0,style:{width:"100%"},ref:R,placeholder:(0,T.jsx)(m.A,{id:G?"documents.recipientsHintPlaceHolder":"common.searchNew"}),notFoundContent:null,onChange:(e,s)=>{e&&"new"===e.toString()?ee((e=>({...e,addContactVis:!0}))):(s.obj.is_new=!0,function(e,s){const t=B.signleSelection?[]:[...X],i=(0,b.isObject)(s)&&(null===s||void 0===s?void 0:s.obj)||{},n=!!i.department_id,a=e?e.toString().toLowerCase():"";if((0,x.DT)(a)||n){let e={};(0,b.isEmpty)(i)?a&&(e={email:a}):e=i,t.findIndex((e=>(0,b.isEqual)(e.email,a)||n&&(0,b.isEqual)(e.department_id,i.department_id)))<0&&(t.push(e),Z(t))}else(0,d.A)("error","err.invalidEmail")}(e,s))},filterOption:ie,value:[],children:[(0,T.jsx)(E,{children:(0,T.jsx)("p",{style:{fontWeight:550},children:(0,T.jsx)(m.A,{id:"common.addNew"})})},"new"),e.map(ce)]}),W&&(0,T.jsx)("p",{className:"mt10 fw550",children:(0,T.jsx)(m.A,{id:"document.shareUpgradeLimit"})})]})})]}),(0,b.isArray)(X)&&!(0,b.isEmpty)(X)||se.sharedLoading?(0,T.jsx)(_.A,{span:24,className:"mt10",children:(0,T.jsx)(M.h2,{children:(0,T.jsx)(l.A,{autoHeight:!0,autoHeightMax:Math.round(t-t/1.8),autoHide:!1,children:(0,T.jsx)(j.A,{className:"selectedUsersList wfUserList",itemLayout:"vertical",dataSource:X,loading:se.sharedLoading,renderItem:oe})})})}):null]})}()})})})}),(0,T.jsx)(u.A,{visible:$.addContactVis,onClose:()=>{ee((e=>({...e,addContactVis:!1})))},handleSubmit:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;const t={...e,name:(0,x.dS)(e.first_name,e.last_name),is_new:!0},i=[...se.teamMembers];if(i.push(t),te((e=>({...e,teamMembers:i}))),s){const e=[...X];e.push(t),Z(e)}ee((e=>({...e,addContactVis:!1})))},modalData:{title:"user.addUser",selText:"document.makeUser"}})]})}))},13771:(e,s,t)=>{t.d(s,{A:()=>j});var i=t(41893),n=t(37734),a=t(6819),r=t(35676),d=t(68265),o=t(41135),c=t(87094),l=t(41988),m=t(55902),u=t(9950),h=t(94885),x=t(8187),p=t(44414);const j=function(e){const{visible:s,onClose:t,handleSubmit:j,modalData:A={}}=e,g=A||{},[f]=d.A.useForm(),[v,_]=(0,u.useState)(!1);(0,r.A)({form:f,visible:s,initVal:{is_selected:!1}});const y=(0,p.jsx)(d.A.Item,{name:"country",className:"countryFormItem",style:{marginBottom:0},children:(0,p.jsx)(h.A,{keyType:"code",valType:"dial_code",className:"countryPicker",filterOption:x.Tk,showSearch:!0,dropDownCustom:!1,allCountries:!0,userVerification:!0,optionFilterProp:!0})});return(0,p.jsx)(o.A,{title:(0,p.jsx)(n.A,{id:g.title||"documents.addRecipient"}),open:s,okText:(0,p.jsx)(n.A,{id:"common.submit"}),onCancel:v?null:t,onOk:v?null:function(){f.validateFields().then((e=>{!async function(e){_(!0);try{const s=new FormData;s.append("email",e.email),s.append("first_name",e.first_name),s.append("phone_number",e.phone_number);const t=await(0,a.Ay)("contact/create",s,"POST",void 0,!0);t.success?((0,i.A)("success",t.message),j(e)):(0,i.A)("error",t.message),_(!1)}catch(s){_(!1),(0,i.A)("error")}}(e)}))},okButtonProps:{id:"add-user"},confirmLoading:v,children:(0,p.jsx)(d.A,{form:f,layout:"vertical",children:(0,p.jsxs)(c.A,{gutter:6,children:[(0,p.jsx)(l.A,{span:24,children:(0,p.jsx)(d.A.Item,{label:(0,p.jsx)(n.A,{id:"common.fullName"}),name:"first_name",rules:[{required:!0,message:(0,p.jsx)(n.A,{id:"req.name"})},{max:50,message:(0,p.jsx)(n.A,{id:"err.max.50char"})},{whitespace:!0,message:(0,p.jsx)(n.A,{id:"err.blankSpace"})}],children:(0,p.jsx)(m.A,{})})}),(0,p.jsx)(l.A,{span:24,children:(0,p.jsx)(d.A.Item,{label:(0,p.jsx)(n.A,{id:"antTable.title.email"}),name:"email",rules:[{required:!0,message:(0,p.jsx)(n.A,{id:"req.email"})},{type:"email",message:(0,p.jsx)(n.A,{id:"err.email"})},{max:255,message:(0,p.jsx)(n.A,{id:"err.max.255char"})}],children:(0,p.jsx)(m.A,{})})}),(0,p.jsx)(l.A,{span:24,children:(0,p.jsx)(d.A.Item,{label:(0,p.jsx)(n.A,{id:"common.phoneNo"}),name:"phone_number",rules:[{max:15,message:(0,p.jsx)(n.A,{id:"err.max.15char"})},{whitespace:!0,message:(0,p.jsx)(n.A,{id:"err.blankSpace"})}],children:(0,p.jsx)(m.A,{type:"number",addonBefore:y})})})]})})})}},15306:(e,s,t)=>{t.d(s,{A:()=>o});var i=t(58168),n=t(9950);const a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908 640H804V488c0-4.4-3.6-8-8-8H548v-96h108c8.8 0 16-7.2 16-16V80c0-8.8-7.2-16-16-16H368c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h108v96H228c-4.4 0-8 3.6-8 8v152H116c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16H292v-88h440v88H620c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h288c8.8 0 16-7.2 16-16V656c0-8.8-7.2-16-16-16zm-564 76v168H176V716h168zm84-408V140h168v168H428zm420 576H680V716h168v168z"}}]},name:"apartment",theme:"outlined"};var r=t(25085),d=function(e,s){return n.createElement(r.A,(0,i.A)({},e,{ref:s,icon:a}))};const o=n.forwardRef(d)}}]);