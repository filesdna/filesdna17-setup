"use strict";(self.webpackChunkfilesdna=self.webpackChunkfilesdna||[]).push([[1333],{12197:(e,t,n)=>{n.d(t,{A:()=>v});var a,o=n(9950),s=n(90101),i=n(1203),l=n(18469),r=n(98341),c=n(21270),d=n(37734),u=n(41397),p=n(98581),m=n(57528),h=n(33753),f=n(73053),y=n(1868);const x=(0,f.A)(h.Ay.div(a||(a=(0,m.A)(["\n  & .moveHome {\n    padding: 6px;\n    margin-bottom: 8px;\n    cursor: pointer;\n    transition: all 0.3s;\n\n    &:hover {\n      background-color: #f5f5f5;\n    }\n\n    &.selected {\n      background: ",";\n      color: #fff;\n    }\n\n    & p {\n      font-size: 15px;\n      & .anticon {\n        margin: ",";\n        font-size: 16px;\n      }\n    }\n  }\n\n  & .ant-tree {\n    & .ant-tree-list {\n      & .ant-tree-list-holder-inner {\n        overflow-x: auto;\n\n        & .ant-tree-treenode {\n          & .ant-tree-indent {\n            white-space: initial;\n          }\n        }\n      }\n\n      & .ant-tree-switcher,\n      & .ant-tree-iconEle {\n        height: 34px;\n        line-height: 34px;\n\n        & .anticon {\n          font-size: 13px;\n        }\n      }\n      & .ant-tree-iconEle {\n        & .anticon {\n          font-size: 18px;\n        }\n      }\n      & .ant-tree-node-content-wrapper {\n        min-height: 34px;\n        line-height: 34px;\n\n        & .ant-tree-title {\n          font-size: 15px;\n          font-weight: 500;\n          margin-left: 5px;\n        }\n      }\n    }\n  }\n"])),(0,y.palette)("primary",0),(e=>"rtl"===e["data-rtl"]?"0 25px 0 10px":"0 10px 0 0")));var A=n(44414);const{DirectoryTree:g}=s.A,v=e=>{const{visible:t=!1,onSelect:n=(()=>{}),height:a,selected:s=[],hint:m="",multiple:h=!1}=e,[f,y]=(0,o.useState)({loading:!1,data:[]}),v=(0,r.useSelector)((e=>e.Auth.userData)),j="undefined"!==typeof window?window.innerHeight:800,w=async e=>{if(!Array.isArray(e))return[];const t=e.map((async e=>{const t=e.is_sub?await(async e=>{const t={params:{login:v.email}};return(await l.A.post("".concat(p.A.apiDomain,"/api/attachments/file-sub-directories/").concat(e),t,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data.result.directories||[]})(e.directory_id):[],n=await w(t);return{title:e.directory_name,key:e.directory_id.toString(),children:n}}));return Promise.all(t)};(0,o.useEffect)((()=>{if(t){const e=async()=>{const e=await(async()=>{const e={params:{login:v.email}};return(await l.A.post("".concat(p.A.apiDomain,"/api/attachments/file-directories"),e,{headers:{Accept:"application/json","Content-Type":"application/json"}})).data.result.directories||[]})(),t=await w(e);y({loading:!1,data:t})};y({loading:!0,data:[]}),e()}else n([])}),[t]);return(0,A.jsxs)(x,{children:[m&&(0,A.jsx)("p",{className:"mb20",children:(0,A.jsx)(d.A,{id:m})}),f.loading||(0,u.isEmpty)(f.data)?(0,A.jsx)(i.A,{description:(0,A.jsx)(d.A,{id:"documents.noDir"})}):(0,A.jsx)(c.A,{style:{height:a||j-Math.round(j/1.5)},children:(0,A.jsx)(g,{height:a,treeData:f.data,onSelect:e=>{const t=(0,u.isEqual)(e,s)?[]:e;n(t)},selectedKeys:s,multiple:h})})]})}},626:(e,t,n)=>{n.d(t,{A:()=>p});var a=n(37734),o=n(6819),s=n(99386),i=n(52160),l=n(72612),r=n(41397),c=n(9950),d=n(44414);const{Option:u}=s.A;const p=function(e){const{onChange:t=(()=>{}),onSelect:n=(()=>{}),onDeselect:p=(()=>{}),placeholder:m,apiData:h={},initVal:f,fullData:y=!1,allowClear:x=!0,disabled:A=!1,mode:g,vKey:v="",lKey:j="",value:w,refSelect:b,renderOption:S=null,addNew:D=!1,onClear:C=(()=>{}),onClick:_=(()=>{}),open:k,onFocus:F=(()=>{}),onBlur:T=(()=>{})}=e,[z,E]=(0,c.useState)({data:[],fetching:!1}),[O,U]=(0,c.useState)(!1);let P=0;const{fetching:B,data:I}=z,N=O?I:I.slice(0,10);(0,c.useEffect)((()=>{(0,r.isObject)(f)&&!(0,r.isEmpty)(f)&&E((e=>({...e,value:f})))}),[f]);const M=async()=>{const e=(0,r.isObject)(h)?h:{};try{const t=await(0,o.Ay)(e.apiUrl,{}),n=t&&(0,r.isArray)(t.data)?t.data:[];E((e=>({...e,data:n,fetching:!1})))}catch(t){E((e=>({...e,data:[],fetching:!1})))}};(0,c.useEffect)((()=>{M()}),[(0,r.isEmpty)(w)]);const H=(0,r.debounce)((async e=>{P+=1;const t=P,n=e?e.trim():"",a=n.length,s=(0,r.isObject)(h)?h:{};if(a>1&&!(0,r.isEmpty)(s)){E((e=>({...e,data:[],fetching:!0})));try{const e=await(0,o.Ay)(s.apiUrl,{[s.apiParam]:n,fullData:y||null}),a=e&&(0,r.isArray)(e.data)?e.data:[];if(t!==P)return;E((e=>({...e,data:a,fetching:!1})))}catch(i){E((e=>({...e,data:[],fetching:!1})))}}else E((e=>({...e,data:[]})))}),800),K=v||"id",V=j||"name",q=()=>U(!0),J=S||function(e){return(0,d.jsx)(u,{value:e[K],obj:e,children:e[V]},e[K])};return(0,d.jsxs)(s.A,{onChange:t,placeholder:m,ref:b,notFoundContent:B?(0,d.jsx)("div",{className:"flexCenter",children:(0,d.jsx)(l.A,{size:"small"})}):null,filterOption:!1,onSearch:H,style:{width:"100%"},allowClear:x,showSearch:!0,disabled:A,mode:g,onSelect:e=>{n(e),M()},onDeselect:p,value:w,onClear:C,onClick:_,open:k,onFocus:F,onBlur:T,children:[N.map(J),D?(0,d.jsx)(u,{children:(0,d.jsx)("p",{style:{fontWeight:550},children:(0,d.jsx)(a.A,{id:"common.addNew"})})},"new"):null,I.map(J).length>10&&!O&&(0,d.jsx)(u,{style:{direction:"rtl"},children:(0,d.jsx)(i.Ay,{type:"text",size:"small",onClick:q,children:(0,d.jsx)(a.A,{id:"common.showMore"})})},"show-more")]})}},56884:(e,t,n)=>{n.d(t,{A:()=>a});const a=n(68265).A},11333:(e,t,n)=>{n.r(t),n.d(t,{default:()=>B});var a=n(57528),o=n(10597),s=n(12197),i=n(58769),l=n(41893),r=n(56884),c=n(41397),d=n(9950),u=(n(92043),n(58660),n(98581)),p=n(45182),m=n(8187),h=n(87259),f=n(75794),y=n(75570),x=n(44414);const{companionUrl:A}=u.A,g=(0,m.J9)("ext");function v(e,t){const{token:n="",uploadFile:a=(()=>{}),folderId:o="0",doc_view:s="portrait",tags:i=[]}=e,r=(0,d.useMemo)((()=>new f.A({debug:!0,autoProceed:!1,restrictions:{maxFileSize:10485760,maxNumberOfFiles:5,minNumberOfFiles:1,allowedFileTypes:g},locale:{strings:{youCanOnlyUploadFileTypes:(0,p.A)("document.fTypeErr")}}}).use(h.A,{companionUrl:A,getUploadParameters(e){const t=e&&e.meta&&e.meta.name?e.meta.name:e.name||"";return fetch("".concat(u.A.apiUrl,"file/sign-s3"),{method:"post",headers:{accept:"application/json","content-type":"application/json",authorization:"Bearer ".concat(n)},body:JSON.stringify({filename:t,contentType:e.type||"",size:e.size||0})}).then((e=>e.json())).then((t=>(0,c.isUndefined)(t.success)||!1!==t.success?{method:t.method,url:t.url,fields:t.fields,headers:{"Content-Type":e.type}}:((0,l.A)("error",t.message),!1)))}}).on("complete",(e=>{console.log("successful files:",e.successful),console.log("failed files:",e.failed);const t=e&&e.successful?e.successful:[];a(t,o,s,i)}))),[]);return(0,d.useEffect)((()=>{r&&(r.setMeta({folderId:o}),r.setMeta({doc_view:s}),r.setMeta({tags:i}))}),[o,s,i]),(0,d.useEffect)((()=>()=>r.close()),[]),(0,d.useImperativeHandle)(t,(()=>({uploadDocs:()=>new Promise(((e,t)=>{r.upload().then((t=>e(t))).catch((e=>t(e)))}))}))),(0,x.jsx)(y.A,{note:(0,p.A)("err.maxFileValidation"),uppy:r,inline:!0,hideUploadButton:!0,target:"body",replaceTargetContent:!0,showProgressDetails:!0,height:320,width:"100%",browserBackButtonClose:!0})}const j=(0,d.forwardRef)(v);var w,b=n(78254),S=n(37734),D=n(6819),C=n(35676),_=n(72612),k=n(87094),F=n(23072),T=n(41988),z=n(24893),E=n(98341),O=n(33753),U=n(626),P=n(34845);const B=function(e){var t,n,a,i;const{dData:u={},handleSubmit:p=(()=>{}),visible:m=!1,onClose:h=(()=>{}),cFolderId:f=0}=e,y=(null===u||void 0===u?void 0:u.apiData)||{},{idToken:A,access:g={},userData:v}=(0,E.useSelector)((e=>e.Auth)),{current:w={}}=(0,E.useSelector)((e=>e.App)),O=null===g||void 0===g?void 0:g.is_free_plan,B="Form"===(null===u||void 0===u||null===(t=u.apiData)||void 0===t?void 0:t.doc_type),N=null===v||void 0===v||null===(n=v.plan)||void 0===n||null===(a=n.currentPlan)||void 0===a||null===(i=a.features)||void 0===i?void 0:i.forms,M="documents"===w[0],H=(0,d.useRef)(null),[K,V]=(0,d.useState)(!1),[q,J]=(0,d.useState)([]),[L,R]=(0,d.useState)(!1),[G]=r.A.useForm(),[W,$]=(0,d.useState)("portrait"),[Q,X]=(0,d.useState)([]),[Y,Z]=(0,d.useState)(!1),ee=(0,c.isArray)(q)&&!(0,c.isEmpty)(q)?q.toString():"";(0,C.A)({form:G,visible:m}),(0,d.useEffect)((()=>{m&&J(""),R(m)}),[m]);const te=()=>{let e=!1;var t;B?e=N&&O?0===(null===g||void 0===g||null===(t=g.monthly_features)||void 0===t?void 0:t.num_of_forms):O:M&&g.document_limit&&(e=g.document_limit);return e};function ne(e,t){if("add"===t){const t=e?e.toString().trim():"";if(t){const e=[...Q];e.push(t),X(e)}else(0,l.A)("error","err.tagBlank")}else if("remove"===t){const t=[...Q],n=t.indexOf(e);n>-1&&(t.splice(n,1),X(t))}}return(0,x.jsx)(o._H,{children:(0,x.jsx)(I,{open:m,onClose:K?null:h,title:(0,x.jsx)(S.A,{id:"documents.uploadDoc"}),okText:(0,x.jsx)(S.A,{id:"documents.upload"}),onOk:async function(){if(H&&H.current)try{V("btn");await H.current.uploadDocs()||((0,l.A)("error","documents.failedUpload"),V(!1))}catch(e){V(!1)}else(0,l.A)("error")},onCancel:K?null:h,confirmLoading:K,destroyOnClose:!0,width:630,style:{top:35},footer:g.document_limit||te()?null:void 0,children:(0,x.jsx)(_.A,{spinning:K&&"btn"!==K,children:(0,x.jsx)(r.A,{form:G,initialValues:{doc_view:W},layout:"vertical",children:(0,x.jsx)(P.$8,{children:te()?(0,x.jsx)(b.default,{msg:"upgrade.reasonDoc"}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(j,{ref:H,token:A,folderId:ee||f||"0",doc_view:W,uploadFile:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=e.length;t>0?(V(!0),await Promise.all(e.map((async(e,n)=>{var a,o,s;const i=(0,c.isObject)(e)?e:{},r=n===t-1,d=i&&i.meta&&i.meta.name?i.meta.name:i.name||"",u={doc_view:null===i||void 0===i||null===(a=i.meta)||void 0===a?void 0:a.doc_view,folder_id:["Template","Attachment"].includes(y.doc_type)&&"team"===v.role?"0":(null===i||void 0===i||null===(o=i.meta)||void 0===o?void 0:o.folderId)||0,filename:d,type:i.type||"",size:i.size||0,source:i.source||"react:Dashboard",doc_type:y.doc_type||"Document",tags:null===i||void 0===i||null===(s=i.meta)||void 0===s?void 0:s.tags};try{const e=await(0,D.Ay)("file/add-document",u,"POST"),{success:t}=e;if(r){V(!1);const e=n>0?"documents.successUploadDocs":"documents.successUploadDoc";(0,l.A)(t?"success":"error",t?e:"documents.failedUpload"),t&&(p(),X([]))}}catch(h){r&&(V(!1),(0,l.A)("error"))}var m;await(m=2e3,new Promise((e=>setTimeout(e,m))))})))):V(!1)},tags:Q}),(0,x.jsxs)(k.A,{gutter:6,children:[(0,x.jsx)(F.A,{}),(0,x.jsx)(T.A,{xs:11,children:(0,x.jsx)(r.A.Item,{name:"doc_view",className:"exportFormItem",label:(0,x.jsx)(S.A,{id:"documents.selectViewType"}),rules:[{required:!0,message:"Please select document view type"}],children:(0,x.jsxs)(z.Ay.Group,{size:"large",onChange:e=>{$(e.target.value)},value:W,children:[(0,x.jsx)(z.Ay,{id:"pdf-view",value:"portrait",children:(0,x.jsx)(S.A,{id:"documents.portrait"})}),(0,x.jsx)(z.Ay,{id:"pdf-view",value:"landscape",children:(0,x.jsx)(S.A,{id:"documents.landscape"})})]})})}),(0,x.jsx)(T.A,{xs:2,style:{borderLeft:"2px dashed rgba(0, 151, 167, 0.4)"}}),(0,x.jsxs)(T.A,{xs:11,children:[(0,x.jsx)("h3",{style:{marginBottom:10,fontSize:"14px"},children:(0,x.jsx)(S.A,{id:"documents.searchTags"})}),(0,x.jsx)(U.A,{refSelect:null,mode:"tags",apiData:{apiParam:"keyword",apiUrl:"file/get-tags"},placeholder:(0,x.jsx)(S.A,{id:"documents.searchTags"}),vKey:"name",onSelect:e=>{"show-more"!==e&&ne(e,"add")},onDeselect:e=>ne(e,"remove"),value:Q,onClear:()=>X([]),open:Y,onFocus:()=>Z(!0),onBlur:()=>Z(!1)})]})]}),(0,x.jsxs)(k.A,{gutter:6,children:[(0,x.jsx)(F.A,{}),(0,x.jsx)(T.A,{span:24,children:(0,x.jsx)(s.A,{dData:u,hint:"documents.folderHint",onSelect:e=>J(e),visible:L,height:200,selected:q})})]})]})})})})})})},I=(0,O.Ay)(i.A)(w||(w=(0,a.A)([""])))}}]);